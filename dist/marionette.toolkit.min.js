!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(require("backbone.marionette"),require("underscore"),require("backbone")):"function"==typeof define&&define.amd?define(["backbone.marionette","underscore","backbone"],e):e(t.Marionette,t._,t.Backbone)}(this,function(t,e,i){"use strict";var s=t.Object.extend({StateModel:i.Model,constructor:function(i){i=i||{},e.extend(this,e.pick(i,["StateModel","stateEvents"]));var s=this.getStateModelClass();this._stateModel=new s,this.bindEntityEvents(this._stateModel,e.result(this,"stateEvents")),t.Object.call(this,i)},getStateModelClass:function(){return this.StateModel},setState:function(){return this._stateModel.set.apply(this._stateModel,arguments)},getState:function(t){return t?this._stateModel.get.apply(this._stateModel,arguments):this._stateModel},destroy:function(){this._stateModel.stopListening(),t.Object.prototype.destroy.apply(this,arguments)}}),n=s.extend({_isRunning:!1,_isDestroyed:!1,preventDestroy:!1,startAfterInitialized:!1,startWithParent:!1,stopWithParent:!0,constructor:function(t){t=t||{},e.bindAll(this,"start","stop");var i=["startWithParent","stopWithParent","startAfterInitialized","preventDestroy"];e.extend(this,e.pick(t,i)),s.call(this,t),e.result(this,"startAfterInitialized")&&this.start(t)},_ensureAppIsIntact:function(){if(this._isDestroyed)throw new t.Error({name:"AppDestroyedError",message:"App has already been destroyed and cannot be used."})},isRunning:function(){return this._isRunning},start:function(t){return this._ensureAppIsIntact(),this._isRunning?this:(this.triggerMethod("before:start",t),this._isRunning=!0,this.triggerMethod("start",t),this)},stop:function(t){return this._isRunning?(this.triggerMethod("before:stop",t),this._isRunning=!1,this.triggerMethod("stop",t),this._stopRunningListeners(),this._stopRunningEvents(),this):this},isDestroyed:function(){return this._isDestroyed},destroy:function(){this.stop(),this._isDestroyed=!0,s.prototype.destroy.apply(this,arguments)},_stopRunningEvents:function(){e.each(this._runningEvents,function(t){this.off.apply(this,t)},this)},_stopRunningListeners:function(){e.each(this._runningListeningTo,function(t){this.stopListening.apply(this,t)},this)},on:function(){return this._isRunning&&(this._runningEvents=this._runningEvents||[],this._runningEvents.push(arguments)),s.prototype.on.apply(this,arguments)},listenTo:function(){return this._isRunning&&(this._runningListeningTo=this._runningListeningTo||[],this._runningListeningTo.push(arguments)),s.prototype.listenTo.apply(this,arguments)}}),r=n.extend({constructor:function(t){t=t||{},this._childApps={},e.extend(this,e.pick(t,["childApps"])),this._initChildApps(),this.on({start:this._startChildApps,"before:stop":this._stopChildApps,"before:destroy":this._destroyChildApps}),n.call(this,t)},_initChildApps:function(){this.childApps&&this.addChildApps(e.result(this,"childApps"))},_startChildApps:function(){e.each(this._childApps,function(t){e.result(t,"startWithParent")&&t.start()})},_stopChildApps:function(){e.each(this._childApps,function(t){e.result(t,"stopWithParent")&&t.stop()})},_destroyChildApps:function(){e.each(this._childApps,function(t){e.result(t,"preventDestroy")||t.destroy()})},_buildAppFromObject:function(t){var i=t.AppClass,s=e.omit(t,"AppClass");return new i(s)},buildApp:function(t,i){return e.isFunction(t)?new t(i):e.isObject(t)?this._buildAppFromObject(t):void 0},_ensureAppIsUnique:function(e){if(this._childApps[e])throw new t.Error({name:"DuplicateChildAppError",message:"A child App with that name has already been added."})},addChildApps:function(t){e.each(t,function(t,e){this.addChildApp(e,t)},this)},addChildApp:function(i,s,n){this._ensureAppIsUnique(i);var r=this.buildApp(s,n);if(!r)throw new t.Error({name:"AddChildAppError",message:"App build failed.  Incorrect configuration."});return this._childApps[i]=r,r.on("destroy",e.partial(this._removeChildApp,i),this),this.isRunning()&&e.result(r,"startWithParent")&&r.start(),r},getChildApps:function(){return e.clone(this._childApps)},getChildApp:function(t){return this._childApps[t]},_removeChildApp:function(t){delete this._childApps[t]},removeChildApps:function(){var t=this.getChildApps();return e.each(this._childApps,function(t,e){this.removeChildApp(e)},this),t},removeChildApp:function(t,i){i=i||{};var s=this.getChildApp(t);if(s)return i.preventDestroy||e.result(s,"preventDestroy")?this._removeChildApp(t):s.destroy(),s}}),o=s.extend({ViewClass:t.ItemView,viewEventPrefix:"view",viewOptions:{},constructor:function(t,i){i=i||{},e.extend(this,e.pick(i,["viewEventPrefix","ViewClass","viewOptions","region"])),s.call(this,i),this._setStateDefaults(t)},_shouldDestroy:!0,_setStateDefaults:function(t){e.defaults(t,e.result(this,"defaults")),this.setState(t,{silent:!0})},showIn:function(t){return t&&(this.region=t),this.show(),this},show:function(){if(this._isShown)throw new t.Error({name:"ComponentShowError",message:"Component has already been shown in a region."});if(!this.region)throw new t.Error({name:"ComponentRegionError",message:"Component has no defined region."});return this.listenTo(this.region,"empty",this.destroy),this.triggerMethod("before:show"),this.renderView(),this._isShown=!0,this.triggerMethod("show"),this},renderView:function(){return this.view=this.buildView(),this._proxyViewEvents(),this.triggerMethod("before:render:view",this.view),this._shouldDestroy=!1,this.region.show(this.view),this._shouldDestroy=!0,this.triggerMethod("render:view",this.view),this},_proxyViewEvents:function(){var t=this.getOption("viewEventPrefix");this.view.on("all",function(){var i=e.toArray(arguments),s=i[0];i[0]=t+":"+s,i.splice(1,0,this.view),this.triggerMethod.apply(this,i)},this)},mixinOptions:function(t){var i=e.result(this,"viewOptions");return e.extend({model:this.getState()},i,t)},getViewClass:function(){return this.ViewClass},buildView:function(){var t=this.getViewClass();return new t(this.mixinOptions())},_destroy:function(){s.prototype.destroy.apply(this,arguments),this.region&&this.region.empty()},destroy:function(){this._shouldDestroy&&this._destroy()}}),h=t.Toolkit={};h.StateClass=s,h.App=r,h.Component=o});
//# sourceMappingURL=marionette.toolkit.min.js.map